FROM flink:1.20

ARG MAVEN_MIRROR="https://maven.aliyun.com/repository/public"

ARG FLINK_VERSION="1.20"
ARG PAIMAN_VERSION="0.9.0"
ARG PAIMAN_FLINK="paimon-flink"
ARG PAIMAN_FLINK_JAR="${PAIMAN_FLINK}-${FLINK_VERSION}-${PAIMAN_VERSION}.jar"
ARG PAIMAN_ACTION_JAR="${PAIMAN_FLINK}-action-${PAIMAN_VERSION}.jar"

RUN wget -O /opt/flink/lib/${PAIMAN_FLINK_JAR} \
    "${MAVEN_MIRROR}/org/apache/paimon/${PAIMAN_FLINK}-${FLINK_VERSION}/${PAIMAN_VERSION}/${PAIMAN_FLINK_JAR}"
RUN wget -O /opt/flink/lib/${PAIMAN_ACTION_JAR} \
    "${MAVEN_MIRROR}/org/apache/paimon/${PAIMAN_FLINK}-action/${PAIMAN_VERSION}/${PAIMAN_ACTION_JAR}"

ARG FLINK_SHADED_HADOOP="flink-shaded-hadoop-2-uber"
ARG FLINK_SHADED_HADOOP_VERSION="2.8.3-10.0"
ARG FLINK_SHADED_HADOOP_JAR="${FLINK_SHADED_HADOOP}-${FLINK_SHADED_HADOOP_VERSION}.jar"
RUN wget -O /opt/flink/lib/${FLINK_SHADED_HADOOP_JAR} \
    "${MAVEN_MIRROR}/org/apache/flink/${FLINK_SHADED_HADOOP}/${FLINK_SHADED_HADOOP_VERSION}/${FLINK_SHADED_HADOOP_JAR}"

ARG FLINK_CDC_POSTGRES="flink-sql-connector-postgres-cdc"
ARG FLINK_CDC_POSTGRES_VERSION="3.2.1"
ARG FLINK_CDC_POSTGRES_JAR="${FLINK_CDC_POSTGRES}-${FLINK_CDC_POSTGRES_VERSION}.jar"
RUN wget -O /opt/flink/lib/${FLINK_CDC_POSTGRES_JAR} \
    "${MAVEN_MIRROR}/org/apache/flink/${FLINK_CDC_POSTGRES}/${FLINK_CDC_POSTGRES_VERSION}/${FLINK_CDC_POSTGRES_JAR}"

ARG FLINK_CONNECTOR_KAFKA="flink-connector-kafka"
ARG FLINK_CONNECTOR_KAFKA_VERSION="3.4.0-1.20"
ARG FLINK_CONNECTOR_KAFKA_JAR="${FLINK_CONNECTOR_KAFKA}-${FLINK_CONNECTOR_KAFKA_VERSION}.jar"
RUN wget -O /opt/flink/lib/${FLINK_CONNECTOR_KAFKA_JAR} \
    "${MAVEN_MIRROR}/org/apache/flink/${FLINK_CONNECTOR_KAFKA}/${FLINK_CONNECTOR_KAFKA_VERSION}/${FLINK_CONNECTOR_KAFKA_JAR}"

RUN wget -O /opt/flink/lib/commons-cli-1.9.0.jar \
    "${MAVEN_MIRROR}/commons-cli/commons-cli/1.9.0/commons-cli-1.9.0.jar"

COPY --chown=flink:flink conf/config.yaml /opt/flink/conf/
